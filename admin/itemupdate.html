<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Update Item - Vegefoods</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" href="../css/style.css" />
  </head>
  <body>
    <div class="container">
      <h2 class="mt-4">Update Item</h2>
      <form id="update-item-form">
        <div class="form-group">
          <label for="itemName">Item Name</label>
          <input type="text" class="form-control" id="itemName" required />
        </div>
        <div class="form-group">
          <label for="itemPrice">Price</label>
          <input type="number" class="form-control" id="itemPrice" required />
        </div>
        <div class="form-group">
          <label for="discPrice">Discount Price</label>
          <input type="number" class="form-control" id="discPrice" />
        </div>
        <div class="form-group">
          <label for="itemImage">Item Image</label>
          <input type="file" class="form-control" id="itemImage" />
        </div>
        <button type="submit" class="btn btn-primary">Update Item</button>
      </form>
    </div>

    <script>
      // Fetch item data based on the ID in the query parameters
      async function fetchItemData() {
        const urlParams = new URLSearchParams(window.location.search);
        const itemId = urlParams.get("id");
        try {
          const response = await fetch(`/items/${itemId}`);
          const item = await response.json();
          document.getElementById("itemName").value = item.itemName;
          document.getElementById("itemPrice").value = item.itemPrice;
          document.getElementById("discPrice").value = item.discPrice;
        } catch (error) {
          console.error("Error fetching item data:", error);
        }
      }

      // Handle form submission
      document
        .getElementById("update-item-form")
        .addEventListener("submit", async (event) => {
          event.preventDefault();
          const urlParams = new URLSearchParams(window.location.search);
          const itemId = urlParams.get("id");
          const formData = new FormData(event.target);
          try {
            await fetch(`/items/${itemId}`, {
              method: "PUT",
              body: formData,
            });
            alert("Item updated successfully!");
            window.location.href = "/admin/index.html"; // Redirect to the items list
          } catch (error) {
            console.error("Error updating item:", error);
          }
        });

      fetchItemData();
    </script>
  </body>
</html>
